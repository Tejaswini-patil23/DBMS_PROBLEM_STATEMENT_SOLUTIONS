CREATE TABLE O_RollCall (
    roll_no   NUMBER(5) PRIMARY KEY,
    name      VARCHAR2(30)
);

CREATE TABLE N_RollCall (
    roll_no   NUMBER(5),
    name      VARCHAR2(30)
);

-- Old RollCall
INSERT INTO O_RollCall VALUES (1, 'Teju');
INSERT INTO O_RollCall VALUES (2, 'Riya');
INSERT INTO O_RollCall VALUES (3, 'Amit');

-- New RollCall
INSERT INTO N_RollCall VALUES (2, 'Riya');
INSERT INTO N_RollCall VALUES (3, 'Amit');
INSERT INTO N_RollCall VALUES (4, 'Sneha');
INSERT INTO N_RollCall VALUES (5, 'Karan');

COMMIT;

DECLARE
    -- Cursor for new roll call table
    CURSOR c_new IS
        SELECT roll_no, name FROM N_RollCall;

    v_roll  N_RollCall.roll_no%TYPE;
    v_name  N_RollCall.name%TYPE;
    v_count NUMBER;
BEGIN
    OPEN c_new;
    LOOP
        FETCH c_new INTO v_roll, v_name;
        EXIT WHEN c_new%NOTFOUND;

        -- Check if record already exists in O_RollCall
        SELECT COUNT(*)
        INTO v_count
        FROM O_RollCall
        WHERE roll_no = v_roll;

        IF v_count = 0 THEN
            INSERT INTO O_RollCall (roll_no, name)
            VALUES (v_roll, v_name);

            DBMS_OUTPUT.PUT_LINE('Inserted Roll No: ' || v_roll || ' - ' || v_name);
        ELSE
            DBMS_OUTPUT.PUT_LINE('Skipped Roll No: ' || v_roll || ' (Already Exists)');
        END IF;

    END LOOP;
    CLOSE c_new;

    DBMS_OUTPUT.PUT_LINE('Merge Completed Successfully.');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
END;
/
